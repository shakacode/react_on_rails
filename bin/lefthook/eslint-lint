#!/usr/bin/env bash
# Lint and auto-fix JS/TS files with ESLint
set -euo pipefail

CONTEXT="${1:-staged}"
files="$(bin/lefthook/get-changed-files "$CONTEXT" '\.(js|jsx|ts|tsx)$')"

if [ -z "$files" ]; then
  echo "‚úÖ No JS/TS files to lint with ESLint"
  exit 0
fi

if [ "$CONTEXT" = "all-changed" ]; then
  echo "üîç ESLint on all changed files:"
else
  echo "üîç ESLint on $CONTEXT files:"
fi
printf "  %s\n" $files

# Run ESLint with auto-fix
yarn run eslint $files --report-unused-disable-directives --fix

# Re-stage files if running on staged or all-changed context
if [ "$CONTEXT" = "staged" ] || [ "$CONTEXT" = "all-changed" ]; then
  echo $files | xargs -r git add
  echo "‚úÖ Re-staged fixed files"
fi
