#!/usr/bin/env bash
# Lint Ruby files with RuboCop
set -euo pipefail

CONTEXT="${1:-staged}"
files="$(bin/lefthook/get-changed-files "$CONTEXT" '\.(rb|rake|ru)$')"

if [ -z "$files" ]; then
  echo "âœ… No Ruby files to lint"
  exit 0
fi

if [ "$CONTEXT" = "all-changed" ]; then
  echo "ğŸ” RuboCop on all changed Ruby files:"
else
  echo "ğŸ” RuboCop on $CONTEXT Ruby files:"
fi
printf "  %s\n" $files

if ! bundle exec rubocop --force-exclusion --display-cop-names -- $files; then
  echo ""
  echo "âŒ RuboCop check failed!"
  echo "ğŸ’¡ Auto-fix: bundle exec rubocop --auto-correct --force-exclusion -- $files"
  echo "ğŸš« Skip hook: git commit --no-verify"
  exit 1
fi
echo "âœ… RuboCop checks passed for Ruby files"
