#!/usr/bin/env bash
#
# Check markdown links using lychee (matches CI behavior exactly)
#
# Only checks git-tracked, user-facing docs to match CI workflow:
#   - docs/**/*.md
#   - *.md (root level only)
#   - react_on_rails_pro/docs/**/*.md
#   - react_on_rails_pro/*.md
#
# Usage:
#   bin/check-links
#

set -eo pipefail

if ! command -v lychee &> /dev/null; then
  echo "Error: lychee is not installed. Install it with: cargo install lychee" >&2
  exit 1
fi

{
  git ls-files 'docs/*.md' 'docs/**/*.md'
  git ls-files '*.md' | grep -v '/' || true
  git ls-files 'react_on_rails_pro/docs/*.md' 'react_on_rails_pro/docs/**/*.md'
  git ls-files 'react_on_rails_pro/*.md'
} | sort -u | lychee --config .lychee.toml --files-from -
