#!/usr/bin/env ruby
# frozen_string_literal: true

# Shakapacker precompile hook for React on Rails
#
# This script runs before webpack compilation to generate pack files
# for auto-bundled components. It's called automatically by Shakapacker
# when configured in config/shakapacker.yml:
#   precompile_hook: 'bin/shakapacker-precompile-hook'
#
# See: https://github.com/shakacode/shakapacker/blob/main/docs/precompile_hook.md

require_relative "../config/environment"

begin
  ReactOnRails::PacksGenerator.instance.generate_packs_if_stale
rescue StandardError => e
  warn "âŒ Error in precompile hook: #{e.message}"
  warn e.backtrace.first(5).join("\n")
  exit 1
end
