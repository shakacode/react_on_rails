#!/bin/sh
# Shakapacker precompile hook for React on Rails
#
# This script runs before webpack compilation to generate pack files
# for auto-bundled components (if configured).
#
# See: https://github.com/shakacode/shakapacker/blob/main/docs/precompile_hook.md

set -e

# Generate packs if React on Rails is configured with auto_load_bundle
if [ -f "config/initializers/react_on_rails.rb" ]; then
  # Check for uncommented config lines (ignore lines starting with # after optional whitespace)
  if grep -E "^[[:space:]]*[^#]*config\.auto_load_bundle[[:space:]]*=" config/initializers/react_on_rails.rb >/dev/null || \
     grep -E "^[[:space:]]*[^#]*config\.components_subdirectory[[:space:]]*=" config/initializers/react_on_rails.rb >/dev/null; then
    echo "ðŸ“¦ Generating React on Rails packs..."
    bundle exec rails react_on_rails:generate_packs
    echo "âœ… Pack generation completed successfully"
  fi
fi
