name: PR Welcome Message

on:
  pull_request:
    types: [opened]

jobs:
  welcome:
    runs-on: ubuntu-22.04
    permissions:
      issues: write
      pull-requests: write
    steps:
      - name: Post welcome message
        uses: actions/github-script@v7
        with:
          script: |
            const welcomeMessage = [
              'ðŸ‘‹ **Thanks for your contribution!**',
              '',
              'This PR will run CI tests based on the files you changed. If some tests are skipped and you want to run the full test suite (including minimum dependency tests), you can use these commands:',
              '',
              '### CI Control Commands',
              '',
              '- **`/run-skipped-ci`** - Runs all skipped CI checks and enables full CI mode for this PR',
              '  - Adds the `full-ci` label to ensure future commits also run the full test suite',
              '  - Useful when you want comprehensive testing across all configurations',
              '',
              '- **`/stop-run-skipped-ci`** - Disables full CI mode and returns to standard CI',
              '  - Removes the `full-ci` label',
              '  - Future commits will only run tests for changed files',
              '',
              '**Note:**',
              '- These commands require write access to the repository',
              '- The `full-ci` label is preserved on merged PRs as a historical record',
              '',
              'View CI progress in the [Actions tab](${context.serverUrl}/${context.repo.owner}/${context.repo.repo}/actions).'
            ].join('\n');

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: context.issue.number,
              body: welcomeMessage
            });

            console.log('âœ… Posted welcome message to PR');
