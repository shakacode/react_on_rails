module ReactOnRails
  module Dev
    class DatabaseChecker
      # Result of a database check.
      # - :ok — database is accessible and ready
      # - :error — database is missing, inaccessible, or misconfigured
      # - :not_rails_app — bin/rails was not found (non-Rails project)
      # - :unknown_error — an unexpected exception occurred during the check
      type check_result = { status: Symbol, error?: String }

      def self.check_database: (?skip: bool) -> bool

      private

      def self.should_skip_check?: (bool) -> bool
      def self.run_database_check: () -> check_result
      def self.parse_check_result: (String, String, Process::Status) -> check_result
      def self.check_pending_migrations: () -> void
      def self.print_checking_message: () -> void
      def self.print_database_ok: () -> void
      def self.print_skipped_message: (String) -> void
      def self.print_pending_migrations_warning: () -> void
      def self.print_database_error: (String?) -> void
      def self.truncate_error: (String) -> String
    end
  end
end
