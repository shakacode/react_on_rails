<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 550" font-family="system-ui, -apple-system, sans-serif">
  <defs>
    <linearGradient id="railsGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#dc2626"/>
      <stop offset="100%" style="stop-color:#b91c1c"/>
    </linearGradient>
    <linearGradient id="nodeGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#22c55e"/>
      <stop offset="100%" style="stop-color:#16a34a"/>
    </linearGradient>
    <linearGradient id="reactGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#38bdf8"/>
      <stop offset="100%" style="stop-color:#0ea5e9"/>
    </linearGradient>
    <linearGradient id="browserGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#a855f7"/>
      <stop offset="100%" style="stop-color:#9333ea"/>
    </linearGradient>
    <marker id="arrowGray" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#22c55e"/>
    </marker>
    <marker id="arrowBlue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#0ea5e9"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="900" height="550" fill="#f8fafc"/>

  <!-- Title -->
  <text x="450" y="35" text-anchor="middle" font-size="20" font-weight="bold" fill="#1e293b">Async Props Architecture</text>
  <text x="450" y="55" text-anchor="middle" font-size="12" fill="#64748b">How data flows from Rails to the browser with streaming SSR</text>

  <!-- Rails Server Box -->
  <g transform="translate(50, 90)">
    <rect x="0" y="0" width="180" height="200" rx="12" fill="white" stroke="#dc2626" stroke-width="2"/>
    <rect x="0" y="0" width="180" height="40" rx="12" fill="url(#railsGrad)"/>
    <rect x="0" y="28" width="180" height="12" fill="url(#railsGrad)"/>
    <text x="90" y="26" text-anchor="middle" font-size="14" font-weight="600" fill="white">Rails Server</text>

    <text x="15" y="65" font-size="10" font-weight="500" fill="#1e293b">Controller Action</text>
    <rect x="15" y="75" width="150" height="35" rx="4" fill="#fef2f2" stroke="#fecaca"/>
    <text x="90" y="96" text-anchor="middle" font-size="9" fill="#dc2626" font-family="monospace">react_component(</text>

    <text x="15" y="125" font-size="10" font-weight="500" fill="#1e293b">Async Props</text>
    <rect x="15" y="135" width="150" height="50" rx="4" fill="#fef2f2" stroke="#fecaca"/>
    <text x="90" y="152" text-anchor="middle" font-size="9" fill="#dc2626" font-family="monospace">users: async_prop {</text>
    <text x="90" y="165" text-anchor="middle" font-size="9" fill="#dc2626" font-family="monospace">  User.all</text>
    <text x="90" y="178" text-anchor="middle" font-size="9" fill="#dc2626" font-family="monospace">}</text>
  </g>

  <!-- Node Renderer Box -->
  <g transform="translate(360, 90)">
    <rect x="0" y="0" width="180" height="200" rx="12" fill="white" stroke="#22c55e" stroke-width="2"/>
    <rect x="0" y="0" width="180" height="40" rx="12" fill="url(#nodeGrad)"/>
    <rect x="0" y="28" width="180" height="12" fill="url(#nodeGrad)"/>
    <text x="90" y="26" text-anchor="middle" font-size="14" font-weight="600" fill="white">Node Renderer</text>

    <text x="15" y="65" font-size="10" font-weight="500" fill="#1e293b">React 18 Streaming</text>
    <rect x="15" y="75" width="150" height="35" rx="4" fill="#f0fdf4" stroke="#bbf7d0"/>
    <text x="90" y="96" text-anchor="middle" font-size="9" fill="#16a34a" font-family="monospace">renderToPipeableStream()</text>

    <text x="15" y="125" font-size="10" font-weight="500" fill="#1e293b">Suspense Boundaries</text>
    <rect x="15" y="135" width="150" height="50" rx="4" fill="#f0fdf4" stroke="#bbf7d0"/>
    <text x="90" y="152" text-anchor="middle" font-size="9" fill="#16a34a" font-family="monospace">&lt;Suspense&gt;</text>
    <text x="90" y="165" text-anchor="middle" font-size="9" fill="#16a34a" font-family="monospace">  &lt;UsersList /&gt;</text>
    <text x="90" y="178" text-anchor="middle" font-size="9" fill="#16a34a" font-family="monospace">&lt;/Suspense&gt;</text>
  </g>

  <!-- Browser Box -->
  <g transform="translate(670, 90)">
    <rect x="0" y="0" width="180" height="200" rx="12" fill="white" stroke="#a855f7" stroke-width="2"/>
    <rect x="0" y="0" width="180" height="40" rx="12" fill="url(#browserGrad)"/>
    <rect x="0" y="28" width="180" height="12" fill="url(#browserGrad)"/>
    <text x="90" y="26" text-anchor="middle" font-size="14" font-weight="600" fill="white">Browser</text>

    <text x="15" y="65" font-size="10" font-weight="500" fill="#1e293b">Initial Shell</text>
    <rect x="15" y="75" width="150" height="35" rx="4" fill="#faf5ff" stroke="#e9d5ff"/>
    <text x="90" y="96" text-anchor="middle" font-size="9" fill="#9333ea">Skeleton + Layout</text>

    <text x="15" y="125" font-size="10" font-weight="500" fill="#1e293b">Hydration</text>
    <rect x="15" y="135" width="150" height="50" rx="4" fill="#faf5ff" stroke="#e9d5ff"/>
    <text x="90" y="155" text-anchor="middle" font-size="9" fill="#9333ea">Progressive updates</text>
    <text x="90" y="170" text-anchor="middle" font-size="9" fill="#9333ea">as data arrives</text>
  </g>

  <!-- Arrow: Rails to Node -->
  <g transform="translate(230, 150)">
    <path d="M 0 0 L 115 0" stroke="#64748b" stroke-width="2" marker-end="url(#arrowGray)"/>
    <rect x="30" y="-25" width="55" height="20" rx="4" fill="#f1f5f9"/>
    <text x="57" y="-11" text-anchor="middle" font-size="8" fill="#64748b">NDJSON</text>
  </g>

  <!-- Arrow: Node to Browser (streaming) -->
  <g transform="translate(540, 150)">
    <path d="M 0 0 L 115 0" stroke="#22c55e" stroke-width="2" stroke-dasharray="8,4" marker-end="url(#arrowGreen)"/>
    <rect x="25" y="-25" width="65" height="20" rx="4" fill="#d1fae5"/>
    <text x="57" y="-11" text-anchor="middle" font-size="8" fill="#16a34a">Streaming</text>
  </g>

  <!-- Data Flow Section -->
  <g transform="translate(50, 320)">
    <text x="0" y="0" font-size="14" font-weight="600" fill="#1e293b">Data Flow Timeline</text>

    <!-- Step 1 -->
    <g transform="translate(0, 25)">
      <circle cx="15" cy="15" r="15" fill="#dc2626"/>
      <text x="15" y="20" text-anchor="middle" font-size="12" fill="white" font-weight="bold">1</text>
      <text x="40" y="12" font-size="11" font-weight="500" fill="#1e293b">Rails receives request</text>
      <text x="40" y="26" font-size="10" fill="#64748b">Controller starts async prop evaluation</text>
    </g>

    <!-- Step 2 -->
    <g transform="translate(280, 25)">
      <circle cx="15" cy="15" r="15" fill="#f97316"/>
      <text x="15" y="20" text-anchor="middle" font-size="12" fill="white" font-weight="bold">2</text>
      <text x="40" y="12" font-size="11" font-weight="500" fill="#1e293b">NDJSON stream opens</text>
      <text x="40" y="26" font-size="10" fill="#64748b">Rails sends render request to Node</text>
    </g>

    <!-- Step 3 -->
    <g transform="translate(560, 25)">
      <circle cx="15" cy="15" r="15" fill="#22c55e"/>
      <text x="15" y="20" text-anchor="middle" font-size="12" fill="white" font-weight="bold">3</text>
      <text x="40" y="12" font-size="11" font-weight="500" fill="#1e293b">Shell HTML sent</text>
      <text x="40" y="26" font-size="10" fill="#64748b">Browser receives shell immediately</text>
    </g>

    <!-- Step 4 -->
    <g transform="translate(0, 85)">
      <circle cx="15" cy="15" r="15" fill="#3b82f6"/>
      <text x="15" y="20" text-anchor="middle" font-size="12" fill="white" font-weight="bold">4</text>
      <text x="40" y="12" font-size="11" font-weight="500" fill="#1e293b">Async props resolve</text>
      <text x="40" y="26" font-size="10" fill="#64748b">Rails fetches data (DB, API calls, etc.)</text>
    </g>

    <!-- Step 5 -->
    <g transform="translate(280, 85)">
      <circle cx="15" cy="15" r="15" fill="#8b5cf6"/>
      <text x="15" y="20" text-anchor="middle" font-size="12" fill="white" font-weight="bold">5</text>
      <text x="40" y="12" font-size="11" font-weight="500" fill="#1e293b">Data streamed to Node</text>
      <text x="40" y="26" font-size="10" fill="#64748b">NDJSON chunks with resolved props</text>
    </g>

    <!-- Step 6 -->
    <g transform="translate(560, 85)">
      <circle cx="15" cy="15" r="15" fill="#a855f7"/>
      <text x="15" y="20" text-anchor="middle" font-size="12" fill="white" font-weight="bold">6</text>
      <text x="40" y="12" font-size="11" font-weight="500" fill="#1e293b">React hydrates content</text>
      <text x="40" y="26" font-size="10" fill="#64748b">Suspense boundaries resolve progressively</text>
    </g>
  </g>

  <!-- NDJSON Format Box -->
  <g transform="translate(50, 465)">
    <rect x="0" y="0" width="380" height="70" rx="8" fill="#f1f5f9" stroke="#e2e8f0"/>
    <text x="15" y="22" font-size="11" font-weight="600" fill="#1e293b">NDJSON Stream Format</text>
    <text x="15" y="42" font-size="9" fill="#64748b" font-family="monospace">{"renderingRequest": "..."}</text>
    <text x="15" y="55" font-size="9" fill="#64748b" font-family="monospace">{"resolvedAsyncProp": {"propName": "users", "value": [...]}}</text>
  </g>

  <!-- Key Benefits Box -->
  <g transform="translate(470, 465)">
    <rect x="0" y="0" width="380" height="70" rx="8" fill="#dbeafe" stroke="#93c5fd"/>
    <text x="15" y="22" font-size="11" font-weight="600" fill="#1d4ed8">Key Benefits</text>
    <text x="15" y="40" font-size="9" fill="#3b82f6">✓ Shell renders before data fetching completes</text>
    <text x="15" y="55" font-size="9" fill="#3b82f6">✓ Multiple data sources can load in parallel</text>
    <text x="200" y="40" font-size="9" fill="#3b82f6">✓ Users see content progressively</text>
    <text x="200" y="55" font-size="9" fill="#3b82f6">✓ Improved Time to First Byte</text>
  </g>
</svg>
