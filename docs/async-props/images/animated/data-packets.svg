<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 350" font-family="system-ui, -apple-system, sans-serif">
  <defs>
    <linearGradient id="railsGrad2" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#dc2626"/>
      <stop offset="100%" style="stop-color:#b91c1c"/>
    </linearGradient>
    <linearGradient id="nodeGrad2" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#22c55e"/>
      <stop offset="100%" style="stop-color:#16a34a"/>
    </linearGradient>
    <linearGradient id="browserGrad2" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#a855f7"/>
      <stop offset="100%" style="stop-color:#9333ea"/>
    </linearGradient>
  </defs>

  <!-- Background -->
  <rect width="800" height="350" fill="#0f172a"/>

  <!-- Title -->
  <text x="400" y="35" text-anchor="middle" font-size="18" font-weight="bold" fill="white">NDJSON Streaming Protocol</text>

  <!-- Rails Server -->
  <g transform="translate(50, 70)">
    <rect x="0" y="0" width="150" height="180" rx="10" fill="#1e293b" stroke="#dc2626" stroke-width="2"/>
    <rect x="0" y="0" width="150" height="35" rx="10" fill="url(#railsGrad2)"/>
    <rect x="0" y="25" width="150" height="10" fill="url(#railsGrad2)"/>
    <text x="75" y="23" text-anchor="middle" font-size="12" font-weight="600" fill="white">Rails Server</text>

    <!-- Data sources -->
    <rect x="15" y="50" width="120" height="35" rx="4" fill="#dc2626" opacity="0.2" stroke="#dc2626">
      <animate attributeName="opacity" values="0.2;0.6;0.2" dur="2s" begin="0s" repeatCount="indefinite"/>
    </rect>
    <text x="75" y="72" text-anchor="middle" font-size="10" fill="#fca5a5">Database Query</text>

    <rect x="15" y="95" width="120" height="35" rx="4" fill="#dc2626" opacity="0.2" stroke="#dc2626">
      <animate attributeName="opacity" values="0.2;0.6;0.2" dur="2.5s" begin="0.5s" repeatCount="indefinite"/>
    </rect>
    <text x="75" y="117" text-anchor="middle" font-size="10" fill="#fca5a5">API Call</text>

    <rect x="15" y="140" width="120" height="35" rx="4" fill="#dc2626" opacity="0.2" stroke="#dc2626">
      <animate attributeName="opacity" values="0.2;0.6;0.2" dur="1.8s" begin="0.2s" repeatCount="indefinite"/>
    </rect>
    <text x="75" y="162" text-anchor="middle" font-size="10" fill="#fca5a5">Cache Lookup</text>
  </g>

  <!-- Node Renderer -->
  <g transform="translate(325, 70)">
    <rect x="0" y="0" width="150" height="180" rx="10" fill="#1e293b" stroke="#22c55e" stroke-width="2"/>
    <rect x="0" y="0" width="150" height="35" rx="10" fill="url(#nodeGrad2)"/>
    <rect x="0" y="25" width="150" height="10" fill="url(#nodeGrad2)"/>
    <text x="75" y="23" text-anchor="middle" font-size="12" font-weight="600" fill="white">Node Renderer</text>

    <!-- Processing indicator -->
    <g transform="translate(75, 120)">
      <circle cx="0" cy="0" r="30" fill="none" stroke="#22c55e" stroke-width="2" opacity="0.3"/>
      <circle cx="0" cy="0" r="30" fill="none" stroke="#22c55e" stroke-width="3" stroke-dasharray="47 141" stroke-linecap="round">
        <animateTransform attributeName="transform" type="rotate" values="0;360" dur="2s" repeatCount="indefinite"/>
      </circle>
      <text x="0" y="5" text-anchor="middle" font-size="10" fill="#86efac">React</text>
    </g>
  </g>

  <!-- Browser -->
  <g transform="translate(600, 70)">
    <rect x="0" y="0" width="150" height="180" rx="10" fill="#1e293b" stroke="#a855f7" stroke-width="2"/>
    <rect x="0" y="0" width="150" height="35" rx="10" fill="url(#browserGrad2)"/>
    <rect x="0" y="25" width="150" height="10" fill="url(#browserGrad2)"/>
    <text x="75" y="23" text-anchor="middle" font-size="12" font-weight="600" fill="white">Browser</text>

    <!-- Content blocks filling -->
    <rect x="15" y="50" width="120" height="20" rx="4" fill="#3b82f6">
      <animate attributeName="opacity" values="0;1" dur="0.3s" begin="0.5s" fill="freeze"/>
    </rect>

    <rect x="15" y="80" width="55" height="85" rx="4" fill="#374151">
      <animate attributeName="fill" values="#374151;#10b981" dur="0.3s" begin="2s" fill="freeze"/>
    </rect>

    <rect x="80" y="80" width="55" height="85" rx="4" fill="#374151">
      <animate attributeName="fill" values="#374151;#8b5cf6" dur="0.3s" begin="3.5s" fill="freeze"/>
    </rect>
  </g>

  <!-- NDJSON Stream (Rails to Node) -->
  <g>
    <!-- Stream line -->
    <line x1="200" y1="160" x2="325" y2="160" stroke="#4b5563" stroke-width="3" stroke-dasharray="8,4">
      <animate attributeName="stroke-dashoffset" values="0;-24" dur="0.5s" repeatCount="indefinite"/>
    </line>

    <!-- Packet 1: Render Request -->
    <g>
      <rect x="200" y="145" width="80" height="30" rx="15" fill="#fbbf24">
        <animate attributeName="x" values="200;245" dur="0.8s" begin="0s;5s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0;1;1;0" dur="0.8s" begin="0s;5s" repeatCount="indefinite"/>
      </rect>
      <text x="240" y="165" text-anchor="middle" font-size="9" fill="#1e293b" font-weight="500">
        render
        <animate attributeName="x" values="240;285" dur="0.8s" begin="0s;5s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0;1;1;0" dur="0.8s" begin="0s;5s" repeatCount="indefinite"/>
      </text>
    </g>

    <!-- Packet 2: Users data -->
    <g>
      <rect x="200" y="145" width="80" height="30" rx="15" fill="#22c55e">
        <animate attributeName="x" values="200;245" dur="0.8s" begin="1.5s;6.5s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0;1;1;0" dur="0.8s" begin="1.5s;6.5s" repeatCount="indefinite"/>
      </rect>
      <text x="240" y="165" text-anchor="middle" font-size="9" fill="white" font-weight="500">
        users
        <animate attributeName="x" values="240;285" dur="0.8s" begin="1.5s;6.5s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0;1;1;0" dur="0.8s" begin="1.5s;6.5s" repeatCount="indefinite"/>
      </text>
    </g>

    <!-- Packet 3: Posts data -->
    <g>
      <rect x="200" y="145" width="80" height="30" rx="15" fill="#8b5cf6">
        <animate attributeName="x" values="200;245" dur="0.8s" begin="3s;8s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0;1;1;0" dur="0.8s" begin="3s;8s" repeatCount="indefinite"/>
      </rect>
      <text x="240" y="165" text-anchor="middle" font-size="9" fill="white" font-weight="500">
        posts
        <animate attributeName="x" values="240;285" dur="0.8s" begin="3s;8s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0;1;1;0" dur="0.8s" begin="3s;8s" repeatCount="indefinite"/>
      </text>
    </g>

    <text x="262" y="195" text-anchor="middle" font-size="10" fill="#64748b">NDJSON</text>
  </g>

  <!-- HTML Stream (Node to Browser) -->
  <g>
    <!-- Stream line -->
    <line x1="475" y1="160" x2="600" y2="160" stroke="#4b5563" stroke-width="3" stroke-dasharray="8,4">
      <animate attributeName="stroke-dashoffset" values="0;-24" dur="0.5s" repeatCount="indefinite"/>
    </line>

    <!-- HTML Shell chunk -->
    <g>
      <rect x="475" y="145" width="70" height="30" rx="15" fill="#3b82f6">
        <animate attributeName="x" values="475;530" dur="0.6s" begin="0.4s;5.4s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0;1;1;0" dur="0.6s" begin="0.4s;5.4s" repeatCount="indefinite"/>
      </rect>
      <text x="510" y="165" text-anchor="middle" font-size="9" fill="white" font-weight="500">
        shell
        <animate attributeName="x" values="510;565" dur="0.6s" begin="0.4s;5.4s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0;1;1;0" dur="0.6s" begin="0.4s;5.4s" repeatCount="indefinite"/>
      </text>
    </g>

    <!-- Users HTML chunk -->
    <g>
      <rect x="475" y="145" width="70" height="30" rx="15" fill="#10b981">
        <animate attributeName="x" values="475;530" dur="0.6s" begin="2s;7s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0;1;1;0" dur="0.6s" begin="2s;7s" repeatCount="indefinite"/>
      </rect>
      <text x="510" y="165" text-anchor="middle" font-size="8" fill="white" font-weight="500">
        &lt;Users/&gt;
        <animate attributeName="x" values="510;565" dur="0.6s" begin="2s;7s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0;1;1;0" dur="0.6s" begin="2s;7s" repeatCount="indefinite"/>
      </text>
    </g>

    <!-- Posts HTML chunk -->
    <g>
      <rect x="475" y="145" width="70" height="30" rx="15" fill="#a855f7">
        <animate attributeName="x" values="475;530" dur="0.6s" begin="3.5s;8.5s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0;1;1;0" dur="0.6s" begin="3.5s;8.5s" repeatCount="indefinite"/>
      </rect>
      <text x="510" y="165" text-anchor="middle" font-size="8" fill="white" font-weight="500">
        &lt;Posts/&gt;
        <animate attributeName="x" values="510;565" dur="0.6s" begin="3.5s;8.5s" repeatCount="indefinite"/>
        <animate attributeName="opacity" values="0;1;1;0" dur="0.6s" begin="3.5s;8.5s" repeatCount="indefinite"/>
      </text>
    </g>

    <text x="537" y="195" text-anchor="middle" font-size="10" fill="#64748b">HTML Stream</text>
  </g>

  <!-- Legend -->
  <g transform="translate(50, 280)">
    <rect x="0" y="0" width="700" height="55" rx="8" fill="#1e293b"/>

    <text x="20" y="22" font-size="11" font-weight="600" fill="white">Packet Types:</text>

    <rect x="120" y="10" width="50" height="22" rx="11" fill="#fbbf24"/>
    <text x="145" y="25" text-anchor="middle" font-size="9" fill="#1e293b" font-weight="500">render</text>
    <text x="145" y="45" text-anchor="middle" font-size="8" fill="#64748b">Initial request</text>

    <rect x="220" y="10" width="50" height="22" rx="11" fill="#22c55e"/>
    <text x="245" y="25" text-anchor="middle" font-size="9" fill="white" font-weight="500">users</text>
    <text x="245" y="45" text-anchor="middle" font-size="8" fill="#64748b">Async prop</text>

    <rect x="320" y="10" width="50" height="22" rx="11" fill="#8b5cf6"/>
    <text x="345" y="25" text-anchor="middle" font-size="9" fill="white" font-weight="500">posts</text>
    <text x="345" y="45" text-anchor="middle" font-size="8" fill="#64748b">Async prop</text>

    <rect x="420" y="10" width="50" height="22" rx="11" fill="#3b82f6"/>
    <text x="445" y="25" text-anchor="middle" font-size="9" fill="white" font-weight="500">shell</text>
    <text x="445" y="45" text-anchor="middle" font-size="8" fill="#64748b">HTML chunk</text>

    <rect x="520" y="10" width="70" height="22" rx="11" fill="#10b981"/>
    <text x="555" y="25" text-anchor="middle" font-size="8" fill="white" font-weight="500">&lt;Users/&gt;</text>
    <text x="555" y="45" text-anchor="middle" font-size="8" fill="#64748b">HTML chunk</text>

    <rect x="620" y="10" width="70" height="22" rx="11" fill="#a855f7"/>
    <text x="655" y="25" text-anchor="middle" font-size="8" fill="white" font-weight="500">&lt;Posts/&gt;</text>
    <text x="655" y="45" text-anchor="middle" font-size="8" fill="#64748b">HTML chunk</text>
  </g>
</svg>
