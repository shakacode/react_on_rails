<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 400" font-family="system-ui, -apple-system, sans-serif">
  <defs>
    <linearGradient id="railsGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#dc2626"/>
      <stop offset="100%" style="stop-color:#b91c1c"/>
    </linearGradient>
    <linearGradient id="nodeGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#22c55e"/>
      <stop offset="100%" style="stop-color:#16a34a"/>
    </linearGradient>
    <linearGradient id="browserGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#a855f7"/>
      <stop offset="100%" style="stop-color:#9333ea"/>
    </linearGradient>

    <!-- Data packet gradient -->
    <linearGradient id="packetGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#fbbf24"/>
      <stop offset="100%" style="stop-color:#f59e0b"/>
    </linearGradient>
  </defs>

  <!-- Background -->
  <rect width="800" height="400" fill="#f8fafc"/>

  <!-- Title -->
  <text x="400" y="35" text-anchor="middle" font-size="20" font-weight="bold" fill="#1e293b">Async Props Data Streaming</text>

  <!-- Rails Server Box -->
  <g transform="translate(50, 80)">
    <rect x="0" y="0" width="160" height="120" rx="12" fill="white" stroke="#dc2626" stroke-width="2"/>
    <rect x="0" y="0" width="160" height="35" rx="12" fill="url(#railsGrad)"/>
    <rect x="0" y="23" width="160" height="12" fill="url(#railsGrad)"/>
    <text x="80" y="24" text-anchor="middle" font-size="14" font-weight="600" fill="white">Rails Server</text>

    <!-- Async props indicators -->
    <rect x="15" y="50" width="130" height="25" rx="4" fill="#fef2f2" stroke="#fecaca"/>
    <text x="80" y="67" text-anchor="middle" font-size="10" fill="#dc2626">async_prop { users }</text>

    <rect x="15" y="85" width="130" height="25" rx="4" fill="#fef2f2" stroke="#fecaca"/>
    <text x="80" y="102" text-anchor="middle" font-size="10" fill="#dc2626">async_prop { posts }</text>
  </g>

  <!-- Node Renderer Box -->
  <g transform="translate(320, 80)">
    <rect x="0" y="0" width="160" height="120" rx="12" fill="white" stroke="#22c55e" stroke-width="2"/>
    <rect x="0" y="0" width="160" height="35" rx="12" fill="url(#nodeGrad)"/>
    <rect x="0" y="23" width="160" height="12" fill="url(#nodeGrad)"/>
    <text x="80" y="24" text-anchor="middle" font-size="14" font-weight="600" fill="white">Node Renderer</text>

    <text x="80" y="60" text-anchor="middle" font-size="10" fill="#16a34a">React 18 Streaming</text>
    <text x="80" y="80" text-anchor="middle" font-size="10" fill="#16a34a">renderToPipeableStream()</text>

    <!-- Suspense indicator -->
    <rect x="25" y="95" width="110" height="20" rx="4" fill="#d1fae5">
      <animate attributeName="fill" values="#d1fae5;#86efac;#d1fae5" dur="2s" repeatCount="indefinite"/>
    </rect>
    <text x="80" y="109" text-anchor="middle" font-size="9" fill="#059669">&lt;Suspense&gt;</text>
  </g>

  <!-- Browser Box -->
  <g transform="translate(590, 80)">
    <rect x="0" y="0" width="160" height="120" rx="12" fill="white" stroke="#a855f7" stroke-width="2"/>
    <rect x="0" y="0" width="160" height="35" rx="12" fill="url(#browserGrad)"/>
    <rect x="0" y="23" width="160" height="12" fill="url(#browserGrad)"/>
    <text x="80" y="24" text-anchor="middle" font-size="14" font-weight="600" fill="white">Browser</text>

    <!-- Browser content area that fills progressively -->
    <rect x="15" y="50" width="130" height="60" rx="4" fill="#faf5ff" stroke="#e9d5ff"/>

    <!-- Shell (always visible) -->
    <rect x="20" y="55" width="120" height="12" rx="2" fill="#a855f7"/>

    <!-- Users section (animates in) -->
    <rect x="20" y="72" width="55" height="33" rx="2" fill="#e9d5ff">
      <animate attributeName="fill" values="#e9d5ff;#c4b5fd;#a855f7" dur="4s" begin="1s" fill="freeze"/>
    </rect>

    <!-- Posts section (animates in later) -->
    <rect x="80" y="72" width="55" height="33" rx="2" fill="#e9d5ff">
      <animate attributeName="fill" values="#e9d5ff;#c4b5fd;#a855f7" dur="4s" begin="2.5s" fill="freeze"/>
    </rect>
  </g>

  <!-- Animated Data Packets: Rails to Node -->
  <!-- Packet 1: Initial render request -->
  <g>
    <rect x="210" y="130" width="60" height="20" rx="10" fill="url(#packetGrad)">
      <animate attributeName="x" values="210;260" dur="0.5s" begin="0s" fill="freeze"/>
      <animate attributeName="opacity" values="0;1;1;0" dur="0.6s" begin="0s" fill="freeze"/>
    </rect>
    <text x="240" y="144" text-anchor="middle" font-size="8" fill="white" font-weight="500">
      request
      <animate attributeName="x" values="240;290" dur="0.5s" begin="0s" fill="freeze"/>
      <animate attributeName="opacity" values="0;1;1;0" dur="0.6s" begin="0s" fill="freeze"/>
    </text>
  </g>

  <!-- Packet 2: Users data -->
  <g>
    <rect x="210" y="130" width="60" height="20" rx="10" fill="#22c55e">
      <animate attributeName="x" values="210;260" dur="0.5s" begin="1s" fill="freeze"/>
      <animate attributeName="opacity" values="0;1;1;0" dur="0.6s" begin="1s" fill="freeze"/>
    </rect>
    <text x="240" y="144" text-anchor="middle" font-size="8" fill="white" font-weight="500">
      users
      <animate attributeName="x" values="240;290" dur="0.5s" begin="1s" fill="freeze"/>
      <animate attributeName="opacity" values="0;1;1;0" dur="0.6s" begin="1s" fill="freeze"/>
    </text>
  </g>

  <!-- Packet 3: Posts data -->
  <g>
    <rect x="210" y="130" width="60" height="20" rx="10" fill="#3b82f6">
      <animate attributeName="x" values="210;260" dur="0.5s" begin="2.5s" fill="freeze"/>
      <animate attributeName="opacity" values="0;1;1;0" dur="0.6s" begin="2.5s" fill="freeze"/>
    </rect>
    <text x="240" y="144" text-anchor="middle" font-size="8" fill="white" font-weight="500">
      posts
      <animate attributeName="x" values="240;290" dur="0.5s" begin="2.5s" fill="freeze"/>
      <animate attributeName="opacity" values="0;1;1;0" dur="0.6s" begin="2.5s" fill="freeze"/>
    </text>
  </g>

  <!-- Animated Data Packets: Node to Browser (HTML stream) -->
  <!-- Shell HTML -->
  <g>
    <rect x="480" y="130" width="50" height="20" rx="10" fill="#a855f7">
      <animate attributeName="x" values="480;540" dur="0.4s" begin="0.3s" fill="freeze"/>
      <animate attributeName="opacity" values="0;1;1;0" dur="0.5s" begin="0.3s" fill="freeze"/>
    </rect>
    <text x="505" y="144" text-anchor="middle" font-size="8" fill="white" font-weight="500">
      shell
      <animate attributeName="x" values="505;565" dur="0.4s" begin="0.3s" fill="freeze"/>
      <animate attributeName="opacity" values="0;1;1;0" dur="0.5s" begin="0.3s" fill="freeze"/>
    </text>
  </g>

  <!-- Users HTML chunk -->
  <g>
    <rect x="480" y="130" width="50" height="20" rx="10" fill="#22c55e">
      <animate attributeName="x" values="480;540" dur="0.4s" begin="1.5s" fill="freeze"/>
      <animate attributeName="opacity" values="0;1;1;0" dur="0.5s" begin="1.5s" fill="freeze"/>
    </rect>
    <text x="505" y="144" text-anchor="middle" font-size="8" fill="white" font-weight="500">
      users
      <animate attributeName="x" values="505;565" dur="0.4s" begin="1.5s" fill="freeze"/>
      <animate attributeName="opacity" values="0;1;1;0" dur="0.5s" begin="1.5s" fill="freeze"/>
    </text>
  </g>

  <!-- Posts HTML chunk -->
  <g>
    <rect x="480" y="130" width="50" height="20" rx="10" fill="#3b82f6">
      <animate attributeName="x" values="480;540" dur="0.4s" begin="3s" fill="freeze"/>
      <animate attributeName="opacity" values="0;1;1;0" dur="0.5s" begin="3s" fill="freeze"/>
    </rect>
    <text x="505" y="144" text-anchor="middle" font-size="8" fill="white" font-weight="500">
      posts
      <animate attributeName="x" values="505;565" dur="0.4s" begin="3s" fill="freeze"/>
      <animate attributeName="opacity" values="0;1;1;0" dur="0.5s" begin="3s" fill="freeze"/>
    </text>
  </g>

  <!-- Connection lines -->
  <line x1="210" y1="140" x2="320" y2="140" stroke="#94a3b8" stroke-width="2" stroke-dasharray="8,4">
    <animate attributeName="stroke-dashoffset" values="0;-24" dur="1s" repeatCount="indefinite"/>
  </line>
  <line x1="480" y1="140" x2="590" y2="140" stroke="#94a3b8" stroke-width="2" stroke-dasharray="8,4">
    <animate attributeName="stroke-dashoffset" values="0;-24" dur="1s" repeatCount="indefinite"/>
  </line>

  <!-- Labels -->
  <text x="265" y="165" text-anchor="middle" font-size="10" fill="#64748b">NDJSON</text>
  <text x="535" y="165" text-anchor="middle" font-size="10" fill="#64748b">HTML Stream</text>

  <!-- Timeline at bottom -->
  <g transform="translate(50, 240)">
    <text x="0" y="0" font-size="14" font-weight="600" fill="#1e293b">Timeline</text>

    <!-- Timeline bar background -->
    <rect x="0" y="15" width="700" height="40" rx="6" fill="#f1f5f9"/>

    <!-- Animated progress bar -->
    <rect x="0" y="15" width="0" height="40" rx="6" fill="#dbeafe">
      <animate attributeName="width" values="0;700" dur="4s" fill="freeze"/>
    </rect>

    <!-- Event markers -->
    <!-- Shell sent -->
    <g opacity="0">
      <animate attributeName="opacity" values="0;1" dur="0.1s" begin="0.3s" fill="freeze"/>
      <line x1="35" y1="15" x2="35" y2="55" stroke="#a855f7" stroke-width="2"/>
      <circle cx="35" cy="35" r="8" fill="#a855f7"/>
      <text x="35" y="39" text-anchor="middle" font-size="8" fill="white">1</text>
      <text x="35" y="70" text-anchor="middle" font-size="9" fill="#64748b">Shell</text>
      <text x="35" y="82" text-anchor="middle" font-size="8" fill="#a855f7">50ms</text>
    </g>

    <!-- Users loaded -->
    <g opacity="0">
      <animate attributeName="opacity" values="0;1" dur="0.1s" begin="1.5s" fill="freeze"/>
      <line x1="260" y1="15" x2="260" y2="55" stroke="#22c55e" stroke-width="2"/>
      <circle cx="260" cy="35" r="8" fill="#22c55e"/>
      <text x="260" y="39" text-anchor="middle" font-size="8" fill="white">2</text>
      <text x="260" y="70" text-anchor="middle" font-size="9" fill="#64748b">Users</text>
      <text x="260" y="82" text-anchor="middle" font-size="8" fill="#22c55e">500ms</text>
    </g>

    <!-- Posts loaded -->
    <g opacity="0">
      <animate attributeName="opacity" values="0;1" dur="0.1s" begin="3s" fill="freeze"/>
      <line x1="520" y1="15" x2="520" y2="55" stroke="#3b82f6" stroke-width="2"/>
      <circle cx="520" cy="35" r="8" fill="#3b82f6"/>
      <text x="520" y="39" text-anchor="middle" font-size="8" fill="white">3</text>
      <text x="520" y="70" text-anchor="middle" font-size="9" fill="#64748b">Posts</text>
      <text x="520" y="82" text-anchor="middle" font-size="8" fill="#3b82f6">900ms</text>
    </g>

    <!-- Complete -->
    <g opacity="0">
      <animate attributeName="opacity" values="0;1" dur="0.1s" begin="4s" fill="freeze"/>
      <line x1="700" y1="15" x2="700" y2="55" stroke="#059669" stroke-width="2"/>
      <circle cx="700" cy="35" r="8" fill="#059669"/>
      <text x="700" y="39" text-anchor="middle" font-size="8" fill="white">✓</text>
      <text x="700" y="70" text-anchor="middle" font-size="9" fill="#64748b">Done</text>
    </g>
  </g>

  <!-- TTFB callout -->
  <g transform="translate(50, 340)" opacity="0">
    <animate attributeName="opacity" values="0;1" dur="0.3s" begin="0.5s" fill="freeze"/>
    <rect x="0" y="0" width="200" height="45" rx="8" fill="#d1fae5" stroke="#86efac"/>
    <text x="15" y="20" font-size="11" font-weight="600" fill="#059669">⚡ TTFB: 50ms</text>
    <text x="15" y="36" font-size="10" fill="#059669">User sees shell immediately!</text>
  </g>
</svg>
